{% extends 'main/layout.html' %}
{% load static %}

{% block title %}Статус участников{% endblock %}

{% block content %}

<div class="container-fluid pb-5">
	<h1 class="text-center m-3">Положение участников</h1>

    <select class="form-select mt-4 tabs-select tabs-select--mobile" id="team">
		<option value="total-time-tab">Общее время</option>
        <option value="points-time-tab">Время между точками</option>
        <option value="quest-time-tab">Время решения квестов</option>
        <option value="map-tab">Отслеживание по карте</option>
        <option value="teams-tab">Командная статистика</option>
	</select>

    <ul class="nav nav-tabs mt-5 tabs-select" role="tablist">
        <button class="nav-link" id="total-time-tab" data-bs-toggle="tab" data-bs-target="#total-time-tab-pane" type="button" role="tab" aria-controls="total-time-tab-pane" aria-selected="true">Общее время</button>
        <button class="nav-link" id="points-time-tab" data-bs-toggle="tab" data-bs-target="#points-time-tab-pane" type="button" role="tab" aria-controls="points-time-tab-pane" aria-selected="false">Время между точками</button>
        <button class="nav-link" id="quest-time-tab" data-bs-toggle="tab" data-bs-target="#quest-time-tab-pane" type="button" role="tab" aria-controls="quest-time-tab-pane" aria-selected="false">Время решения квестов</button>
        <button class="nav-link" id="map-tab" data-bs-toggle="tab" data-bs-target="#map-tab-pane" type="button" role="tab" aria-controls="map-tab-pane" aria-selected="false">Отслеживание по карте</button>
        <button class="nav-link" id="teams-tab" data-bs-toggle="tab" data-bs-target="#teams-tab-pane" type="button" role="tab" aria-controls="teams-tab-pane" aria-selected="false">Командная статистика</button>
	</ul>

    <div class="tab-content pb-2">
        <div class="tab-pane show" id="total-time-tab-pane" role="tabpanel" aria-labelledby="total-time-tab" tabindex="0">
	        {% if total_teams_time %}
                <table class="table table-striped table-bordered table--status mt-5">
                    <thead>
                        <th></th>
                        <th>Команда</th>
                        <th>Время</th>
                    </thead>
                    <tbody>
                        {% for team in total_teams_time %}
                            <tr>
                                <td>{{ team.place }}</td>
                                <td>{{ team.name }}</td>
                                <td>{{ team.time }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <a href="{% url 'download-total-time-table' %}" class="btn btn-primary">Скачать таблицу</a>
            {% else %}
                <p class="text-center mt-5">Пока нету команд</p>
            {% endif %}
        </div>
        <div class="tab-pane show" id="points-time-tab-pane" role="tabpanel" aria-labelledby="points-time-tab" tabindex="0">
	        {% if total_teams_move_time %}
                <table class="table table-striped table-bordered table--status mt-5">
                    <thead>
                        <th></th>
                        <th>Команда</th>
                        <th>Время</th>
                    </thead>
                    <tbody>
                        {% for team in total_teams_move_time %}
                            <tr>
                                <td>{{ team.place }}</td>
                                <td>{{ team.name }}</td>
                                <td>{{ team.time }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <a href="{% url 'download-move-time-table' %}" class="btn btn-primary">Скачать таблицу</a>
            {% else %}
                <p class="text-center mt-5">Пока нету команд</p>
            {% endif %}
        </div>
        <div class="tab-pane show" id="quest-time-tab-pane" role="tabpanel" aria-labelledby="quest-time-tab" tabindex="0">
            {% if total_teams_quest_time %}
                <table class="table table-striped table-bordered table--status mt-5">
                    <thead>
                        <th></th>
                        <th>Команда</th>
                        <th>Время</th>
                    </thead>
                    <tbody>
                        {% for team in total_teams_quest_time %}
                            <tr>
                                <td>{{ team.place }}</td>
                                <td>{{ team.name }}</td>
                                <td>{{ team.time }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <a href="{% url 'download-quest-time-table' %}" class="btn btn-primary">Скачать таблицу</a>
            {% else %}
                <p class="text-center mt-5">Пока нету команд</p>
            {% endif %}
        </div>
        <div class="tab-pane show" id="map-tab-pane" role="tabpanel" aria-labelledby="map--tab" tabindex="0">
            <div class="map mt-5">
                <div class="map__container">
                    <div class="map__content">
                        {% include 'main/map.svg' %}
                        <img src="{% static 'main/img/map.png' %}" alt="BNTU map">
                        <div class="map__build-info"></div>
                    </div>
                </div>
                <div class="map__data">
                    {% for data in map_data %}
                        <div class="map-data" data-point-id="{{ data.point_id }}" data-not-empty="{{ data.not_empty }}">
                            <span class="map-data__point-name">Точка {{ data.point_name }}</span>
                            <div class="map-data__teams">
                                <span class="map-data__teams-header">Команды на точке:</span>
                                <ul class="map-data__teams-list">
                                    {% for team in data.teams_on_point %}
                                        <li>{{ team }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="tab-pane show" id="teams-tab-pane" role="tabpanel" aria-labelledby="teams-tab" tabindex="0">
            <div class="teams-status mt-5">
                {% for team_stat in team_stats %}
                    <div class="team-status">
                        <div class="team-status__name">
                            <span>{{ team_stat.team_name }}</span>
                        </div>
                        <div class="loading-bar">
                            <div class="loading-bar__amount" style="width: {{ team_stat.percentage_passed }}%;">
                                <div class="loading-bar__loaded">&nbsp;</div>
                                <div class="loading-bar__lines"></div>
                            </div>
                        </div>
                        <div class="team-status__points-passed">
                            <span>Точек пройдено:</span>
                            <div class="team-status__table-container">
                                {% if team_stat.points_passed %}
                                    <table class="table table-striped table-bordered">
                                        <thead>
                                            <th>Номер точки</th>
                                            <th>Точка</th>
                                            <th>Время маршрута</th>
                                            <th>Время прохождения квеста</th>
                                            <th>Общее время</th>
                                        </thead>
                                        <tbody>
                                            {% for point in team_stat.points_passed %}
                                                <tr>
                                                    <td>{{ point.number }}</td>
                                                    <td>{{ point.name }}</td>
                                                    <td>{{ point.move_time }}</td>
                                                    <td>{{ point.quest_time }}</td>
                                                    <td>{{ point.total_time }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}
                                    <p class="text-center mt-5">Команда не прошла ни одной точки</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="team-status__points-left">
                            <span>Точек осталось:</span>
                            {% if team_stat.points_left %}
                                <ul class="list-group">
                                    {% for point in team_stat.points_left %}
                                        <li class="list-group-item">{{ point }}</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-center mt-5">Команда прошла все точки</p>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
	</div>
</div>

{% endblock %}