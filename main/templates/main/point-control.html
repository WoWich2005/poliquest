{% extends 'main/layout.html' %}

{% block title %}Управление точками{% endblock %}

{% block content %}
	
<div class="container-fluid">
	<select class="form-select mt-4 tabs-select tabs-select--mobile" id="team">
		{% for point in points %}
			<option value="timetable{{ point.id }}-tab">{{ point.name }}</option>
		{% endfor %}
	</select>

	<ul class="nav nav-tabs mt-4 tabs-select" role="tablist">
		{% for point in points %}
			<button class="nav-link" id="timetable{{ point.id }}-tab" data-bs-toggle="tab" data-bs-target="#timetable{{ point.id }}-tab-pane" type="button" role="tab" aria-controls="timetable{{ point.id }}-tab-pane" aria-selected="false">{{ point.name }}</button>
		{% endfor %}
	</ul>

	<div class="tab-content pb-2">
		{% for point in points %}
			<div class="tab-pane show" id="timetable{{ point.id }}-tab-pane" role="tabpanel" aria-labelledby="timetable{{ point.id }}-tab" tabindex="0">
				<h2 class="mt-4 text-center">Точка {{ point.name }}</h2>
				
				<table class="table table-striped table-bordered">
					<thead>
                        <tr>
                            <th></th>
                            <th>Тип</th>
                            <th>Время</th>
                            <th></th>
                        </tr>
					</thead>
					<tbody>
						{% if point.stats %}
							{% for row in point.stats %}
								<tr>
									<td>{{ row.team }}</td>
									<td>{{ row.get_type_display }}</td>
									<td>{{ row.time }}</td>
									<td>
										<button class="button button--edit mb-4" data-team="{{ row.team }}" data-action="{{ row.type }}" data-point="{{ point.id }}" data-time="{{ row.formatted_time }}" data-id="{{ row.id }}"></button>
										<button class="button button--delete mb-4" data-point="{{ point.id }}" data-id="{{ row.id }}"></button>
									</td>
								</tr>
							{% endfor %}
						{% else %}
							<tr>
								<td class="text-center" colspan="4">Пока ничего нету</td>
							</tr>
						{% endif %}
					</tbody>
				</table>

                <div class="errors" data-point="{{ point.id }}"></div>

                <label class="d-block mb-3">
                    <span>Выберите команду:</span>
                    <select class="form-select mt-1 select--team-select" data-point="{{ point.id }}">
                        <option value="-1" selected>Выберите команду</option>
                        {% for team in teams %}
                            <option value="{{ team.id }}">{{ team.name }}</option>
                        {% endfor %}
                    </select>
                </label>

                <label class="d-block mb-3">
                    <span>Выберите тип действия:</span>
                    <select class="form-select mt-1 select--action-select" data-point="{{ point.id }}">
                        <option value="-1" selected>Выберите тип действия</option>
                        {% for action in team_actions %}
                            <option value="{{ action.0 }}">{{ action.1 }}</option>
                        {% endfor %}
                    </select>
                </label>

				<div>
					<button class="btn btn-primary mb-2 button--send-record" data-point="{{ point.id }}">Отправить</button>
				</div>
			</div>
		{% endfor %}
	</div>
</div>

<div class="modal fade" id="deleteStatModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Подтвердите действие</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<p>Вы уверены, что хотите удалить запись времени команды?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
				<button type="button" class="btn btn-primary btn--confirm">Удалить</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade edit-record" id="editStatModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Редактирование записи времени команды</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form>
					<p>
						<span>Команда: </span>
						<span class="edit-record__team">ФИТР</span>
					</p>

					<div class="mb-3">
						<label for="startTimeInput" class="form-label">Время действия</label>
						<input type="datetime-local" step="1" class="form-control edit-record__datetime" id="startTimeInput">
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
				<button type="button" class="btn btn-primary edit-record__confirm">Сохранить</button>
			</div>
		</div>
	</div>
</div>

{% endblock %}